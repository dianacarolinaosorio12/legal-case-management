generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique
  name              String
  password          String
  role              UserRole
  area              CaseArea?
  activeCases       Int      @default(0)
  totalPracticeHours Int     @default(0)
  semester          String?
  resetToken        String?   @unique
  resetTokenExpires DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  assignedCases     LegalCase[] @relation("assignedStudent")

  @@map("users")
}

model LegalCase {
  id                String           @id @default(cuid())
  radicado          String           @unique
  clientName        String
  clientDoc         String
  clientDocType     String
  clientPhone       String
  clientEmail       String
  clientAddress     String
  type              CaseType
  area              CaseArea
  status            CaseStatus
  semaphore         SemaphoreColor
  deadline          String
  createdAt         String
  assignedStudentName   String
  assignedProfessor String
  description       String
  isMinor           Boolean
  highRiskAlert     Boolean
  highRiskReason    String?
  procesalDeadlines Json // Array of ProcesalDeadline objects
  reservedData      Json? // ReservedData object
  substitutionHistory Json // Array of substitution objects
  interviewNotes    String?
  aiTags           Json // Array of AITag objects
  auditLog         Json // Array of AuditEntry objects
  survey           Json? // SatisfactionSurvey object
  hoursSpent       Float
  assignedStudentId String? @map("assigned_student_id")
  
  // Relations
  assignedStudent   User?   @relation("assignedStudent", fields: [assignedStudentId], references: [id])
  documents         Document[]
  
  @@map("legal_cases")
}

// Modelo de Documentos para el Document Service
model Document {
  id          String   @id @default(cuid())
  fileName    String
  fileType    String
  fileSize    Int
  legalCaseId String   @map("legal_case_id")
  uploadedBy  String
  description String?
  s3Key       String?  // Clave en S3 (para futura integraci√≥n)
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  legalCase   LegalCase @relation(fields: [legalCaseId], references: [id], onDelete: Cascade)

  @@map("documents")
}

enum UserRole {
  estudiante
  profesor
  administrativo
}

enum CaseType {
  Tutela
  Demanda
  Derecho_de_peticion
  Consulta
}

enum CaseArea {
  Penal
  Civil
  Laboral
  Familia
  Derecho_Publico
}

enum CaseStatus {
  Evaluacion
  Sustanciacion
  Revision_del_profesor
  Aprobado
  Seguimiento
  Cerrado
}

enum SemaphoreColor {
  red
  yellow
  green
}